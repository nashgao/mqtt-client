---
allowed-tools: all
description: Comprehensive milestone completion validation and archival with knowledge capture and template improvement
---

# ‚úÖ‚úÖ‚úÖ CRITICAL REQUIREMENT: MILESTONE COMPLETION AND ARCHIVAL! ‚úÖ‚úÖ‚úÖ

**THIS IS NOT A SIMPLE CLEANUP TASK - THIS IS A COMPREHENSIVE COMPLETION VALIDATION AND KNOWLEDGE CAPTURE SYSTEM!**

When you run `/milestone/archive`, you are REQUIRED to:

1. **VALIDATE** completion criteria against original milestone definition with comprehensive verification
2. **CAPTURE** lessons learned and performance metrics for continuous improvement
3. **ANALYZE** actual vs estimated timelines with detailed variance analysis
4. **ARCHIVE** milestone data with proper cleanup and state management
5. **UPDATE** templates and estimation models based on real-world performance
6. **USE MULTIPLE AGENTS** for comprehensive completion analysis:
   - Spawn one agent for completion criteria validation
   - Spawn another for lessons learned capture and analysis
   - Spawn more agents for template improvement and knowledge extraction
   - Say: "I'll spawn multiple agents to comprehensively validate and archive this milestone"

## üéØ USE MULTIPLE AGENTS

**MANDATORY AGENT SPAWNING FOR COMPLETION COMPLEXITY:**
```
"I'll spawn multiple agents to handle milestone archival comprehensively:
- Validation Agent: Verify all completion criteria and deliverables
- Analysis Agent: Capture performance metrics and variance analysis
- Knowledge Agent: Extract lessons learned and improvement insights
- Archive Agent: Manage data migration and cleanup processes
- Template Agent: Update estimation models and templates based on outcomes"
```

## üö® FORBIDDEN BEHAVIORS

**NEVER:**
- ‚ùå Archive without validating completion criteria ‚Üí NO! Comprehensive verification required!
- ‚ùå Skip lessons learned capture ‚Üí NO! Knowledge extraction is mandatory!
- ‚ùå Ignore performance variance analysis ‚Üí NO! Estimation improvement depends on this!
- ‚ùå Delete milestone data without proper archival ‚Üí NO! Historical data is valuable!
- ‚ùå Archive incomplete milestones ‚Üí NO! Only truly completed milestones!
- ‚ùå "Just move the files" ‚Üí NO! Comprehensive validation and knowledge capture required!

**MANDATORY WORKFLOW:**
```
1. Completion validation ‚Üí Verify ALL success criteria met
2. IMMEDIATELY spawn agents for parallel completion analysis
3. Performance analysis ‚Üí Compare actual vs estimated metrics
4. Knowledge capture ‚Üí Extract lessons learned and improvement insights
5. Template updates ‚Üí Refine estimation models and templates
6. Proper archival ‚Üí Move data with complete audit trail
7. VERIFY archival completeness and knowledge capture
```

**YOU ARE NOT DONE UNTIL:**
- ‚úÖ ALL completion criteria validated and documented
- ‚úÖ Performance variance analysis completed with insights
- ‚úÖ Lessons learned captured with actionable improvements
- ‚úÖ Templates and estimation models updated
- ‚úÖ Data properly archived with audit trail
- ‚úÖ Knowledge base updated for future milestone planning

---

üõë **MANDATORY MILESTONE COMPLETION CHECK** üõë
1. Re-read ../../shared/milestone/context.md to understand milestone context
2. Check ../../shared/milestone/state.md for current milestone state
3. Verify you understand ALL completion criteria before archiving

Execute comprehensive milestone archival with ZERO tolerance for incomplete validation.

**FORBIDDEN SHORTCUT PATTERNS:**
- "Looks complete enough" ‚Üí NO, validate EVERY success criterion
- "Skip the analysis" ‚Üí NO, performance metrics are critical for improvement
- "Just archive the data" ‚Üí NO, knowledge capture is mandatory
- "Don't need to update templates" ‚Üí NO, continuous improvement required
- "Simple file move is sufficient" ‚Üí NO, proper archival process needed

You are archiving milestone: $ARGUMENTS

Let me ultrathink about the comprehensive completion validation and archival architecture.

üö® **REMEMBER: Proper archival preserves knowledge while improving future planning!** üö®

**Comprehensive Milestone Archival Protocol:**

**Step 0: Pre-Archival Validation**
- Verify milestone exists in .milestones/active/ directory
- Check all completion criteria from original milestone definition
- Validate all deliverables and artifacts are complete
- Confirm stakeholder sign-off and acceptance
- Review outstanding dependencies and risk items

**Step 1: Completion Criteria Validation**

**Verification Checklist:**
```yaml
completion_validation:
  success_criteria:
    - criterion_1: "verified|partial|failed"
    - criterion_2: "verified|partial|failed"
    - criterion_3: "verified|partial|failed"
  
  deliverables:
    - name: "Deliverable 1"
      status: "completed|partial|missing"
      acceptance_criteria_met: true/false
      stakeholder_approved: true/false
  
  quality_gates:
    - all_tests_passing: true/false
    - code_review_complete: true/false
    - documentation_updated: true/false
    - deployment_successful: true/false
  
  dependencies:
    - blocking_items_resolved: true/false
    - dependent_milestones_unblocked: true/false
    - external_dependencies_satisfied: true/false
```

**Step 2: Performance Analysis and Metrics Capture**

**Actual vs Estimated Analysis:**
```yaml
performance_analysis:
  timeline:
    estimated_start: "2024-07-01"
    actual_start: "2024-07-03"
    estimated_end: "2024-07-20"
    actual_end: "2024-07-25"
    estimated_hours: 80
    actual_hours: 95
    efficiency_ratio: 0.842
    
  variance_analysis:
    timeline_variance: "+5 days (25%)"
    effort_variance: "+15 hours (18.75%)"
    scope_changes: 3
    blockers_encountered: 2
    
  quality_metrics:
    defects_found: 2
    rework_percentage: 8
    first_time_quality: 92
    stakeholder_satisfaction: 9/10
    
  resource_utilization:
    team_members_involved: 3
    peak_parallel_work: 2
    resource_conflicts: 1
    skill_gaps_identified: ["advanced_testing", "performance_optimization"]
```

**Step 3: Comprehensive Lessons Learned Capture**

**Knowledge Extraction Framework:**
```yaml
lessons_learned:
  what_worked_well:
    - "Clear acceptance criteria prevented scope creep"
    - "Daily standups improved team coordination"
    - "Automated testing caught issues early"
    
  what_could_improve:
    - "Estimation was too optimistic for integration testing"
    - "Need better stakeholder availability planning"
    - "Technical debt cleanup took longer than expected"
    
  unexpected_challenges:
    - "Third-party API changes mid-development"
    - "Performance bottleneck in database queries"
    - "Cross-browser compatibility issues"
    
  key_insights:
    - "Buffer time is essential for integration phases"
    - "Early stakeholder demos prevent late-stage changes"
    - "Parallel development requires careful coordination"
    
  process_improvements:
    - "Add API versioning checks to planning phase"
    - "Include performance testing in definition of done"
    - "Establish clearer handoff protocols between team members"
    
  template_updates_needed:
    estimation_adjustments:
      - "Increase integration testing estimates by 30%"
      - "Add 20% buffer for third-party dependencies"
      - "Include cross-browser testing in web projects"
    
    planning_improvements:
      - "Add API stability risk assessment"
      - "Include stakeholder availability in timeline"
      - "Define clearer acceptance criteria templates"
```

**Step 4: Template and Estimation Model Updates**

**Template Improvement Process:**
```yaml
template_updates:
  estimation_model_adjustments:
    development_phases:
      design: "No change - accurate"
      implementation: "+10% for complexity handling"
      testing: "+30% for integration scenarios"
      deployment: "+15% for production issues"
    
    risk_factors:
      third_party_dependencies: "Medium ‚Üí High risk classification"
      team_coordination: "Add specific coordination overhead"
      stakeholder_availability: "Include in timeline dependencies"
    
  milestone_template_enhancements:
    success_criteria:
      - "Add specific performance benchmarks"
      - "Include stakeholder sign-off checkpoints"
      - "Define rollback criteria explicitly"
    
    task_breakdown:
      - "Split integration tasks into smaller chunks"
      - "Add explicit API versioning checks"
      - "Include cross-browser validation tasks"
```

**Step 5: Multi-Agent Archive Execution**

**Agent Spawning Strategy for Archive Process:**
### Validation Agent:
```markdown
<function_calls>
<invoke name="Task">
<parameter name="subagent_type">general-purpose</parameter>
<parameter name="description">Validate completion</parameter>
<parameter name="prompt">You are the Validation Agent for milestone {{MILESTONE_ID}} archival.

Your responsibilities:
1. Read milestone from .milestones/active/{{MILESTONE_ID}}.yaml
2. Verify all tasks have status: "completed"
3. Check all deliverables are present and documented
4. Validate acceptance criteria are met
5. Confirm all kiro phases completed for each task
6. Generate validation report to .milestones/archive/{{MILESTONE_ID}}/validation.json

Report: PASS if ready for archive, FAIL with specific issues if not.</parameter>
</invoke>
</function_calls>
```

### Metrics Agent:
```markdown
<function_calls>
<invoke name="Task">
<parameter name="subagent_type">general-purpose</parameter>
<parameter name="description">Analyze performance</parameter>
<parameter name="prompt">You are the Metrics Agent for milestone {{MILESTONE_ID}} archival.

Your responsibilities:
1. Calculate actual vs estimated timeline variance
2. Analyze task completion velocity and patterns
3. Compute resource utilization metrics
4. Identify performance bottlenecks and delays
5. Generate metrics report to .milestones/archive/{{MILESTONE_ID}}/metrics.json

Provide comprehensive performance analysis with variance percentages.</parameter>
</invoke>
</function_calls>
```

### Knowledge Agent:
```markdown
<function_calls>
<invoke name="Task">
<parameter name="subagent_type">general-purpose</parameter>
<parameter name="description">Extract lessons</parameter>
<parameter name="prompt">You are the Knowledge Agent for milestone {{MILESTONE_ID}} archival.

Your responsibilities:
1. Analyze what went well and should be repeated
2. Identify challenges and how they were overcome
3. Document process improvements discovered
4. Capture technical decisions and their outcomes
5. Generate lessons learned to .milestones/archive/{{MILESTONE_ID}}/lessons.md

Extract actionable insights for future milestones.</parameter>
</invoke>
</function_calls>
```

### Template Agent:
```markdown
<function_calls>
<invoke name="Task">
<parameter name="subagent_type">general-purpose</parameter>
<parameter name="description">Update templates</parameter>
<parameter name="prompt">You are the Template Agent for milestone {{MILESTONE_ID}} archival.

Your responsibilities:
1. Read metrics from .milestones/archive/{{MILESTONE_ID}}/metrics.json
2. Update estimation models based on actual performance
3. Refine milestone templates with learned patterns
4. Adjust default timelines and resource allocations
5. Generate template updates to .milestones/templates/updates.yaml

Improve future planning accuracy based on this milestone's outcomes.</parameter>
</invoke>
</function_calls>
```

### Archive Agent:
```markdown
<function_calls>
<invoke name="Task">
<parameter name="subagent_type">general-purpose</parameter>
<parameter name="description">Archive milestone</parameter>
<parameter name="prompt">You are the Archive Agent for milestone {{MILESTONE_ID}}.

Your responsibilities:
1. Create archive structure at .milestones/completed/{{MILESTONE_ID}}/
2. Move milestone YAML and all associated files
3. Generate completion certificate with timestamp
4. Update archive index for searchability
5. Clean up active directory and temporary files
6. Create audit trail of archival process

Complete the archival with full data preservation and cleanup.</parameter>
</invoke>
</function_calls>
```

**Step 6: Data Archival and State Management**

**Archive Structure:**
```
.milestones/completed/
‚îú‚îÄ‚îÄ milestone-001/
‚îÇ   ‚îú‚îÄ‚îÄ definition.yaml           # Original milestone definition
‚îÇ   ‚îú‚îÄ‚îÄ completion-report.yaml    # Completion validation results
‚îÇ   ‚îú‚îÄ‚îÄ performance-analysis.yaml # Actual vs estimated metrics
‚îÇ   ‚îú‚îÄ‚îÄ lessons-learned.yaml      # Knowledge capture and insights
‚îÇ   ‚îú‚îÄ‚îÄ stakeholder-feedback.yaml # Acceptance and satisfaction data
‚îÇ   ‚îî‚îÄ‚îÄ audit-trail.jsonl        # Complete event history
‚îú‚îÄ‚îÄ milestone-002/
‚îî‚îÄ‚îÄ archive-index.yaml            # Searchable archive metadata
```

**State Transition Management:**
```yaml
state_transition:
  from_state: "active"
  to_state: "completed"
  transition_date: "2024-07-25T15:30:00Z"
  validation_status: "passed"
  completion_percentage: 100
  
  data_migration:
    source: ".milestones/active/milestone-001.yaml"
    destination: ".milestones/completed/milestone-001/"
    backup_created: true
    audit_trail_preserved: true
    
  cleanup_actions:
    - "Remove from active milestone tracking"
    - "Update dependent milestone status"
    - "Notify stakeholders of completion"
    - "Update project dashboard"
```

**Step 7: Knowledge Base Updates**

**Continuous Improvement Integration:**
```yaml
knowledge_base_updates:
  estimation_database:
    - task_type: "API Integration"
      historical_data:
        - project: "milestone-001"
          estimated: 16
          actual: 22
          variance: "+37.5%"
          complexity_factors: ["third_party", "authentication"]
    
  risk_library:
    - risk_name: "Third-party API Changes"
      frequency: "Medium"
      impact: "High"
      mitigation_strategies:
        - "Implement adapter pattern"
        - "Monitor API changelog"
        - "Maintain fallback options"
    
  best_practices:
    - category: "Stakeholder Management"
      practice: "Early demo sessions prevent scope creep"
      evidence: "milestone-001 had 0 scope changes after demo"
      applicability: "All user-facing features"
```

**Step 8: Archival Verification and Reporting**

**Archive Validation Checklist:**
```yaml
archival_verification:
  data_integrity:
    - [ ] All original milestone data preserved
    - [ ] Performance metrics calculated and stored
    - [ ] Lessons learned documented comprehensively
    - [ ] Audit trail complete and searchable
    - [ ] Stakeholder feedback captured
  
  knowledge_capture:
    - [ ] Process improvements identified
    - [ ] Template updates documented
    - [ ] Estimation model adjustments recorded
    - [ ] Risk library updated
    - [ ] Best practices extracted
  
  system_updates:
    - [ ] Active milestone list updated
    - [ ] Dependent milestones status refreshed
    - [ ] Project dashboard reflects completion
    - [ ] Team notifications sent
    - [ ] Archive index updated
```

**Completion Report Generation:**
```
MILESTONE COMPLETION REPORT
===========================

Milestone: User Authentication System (milestone-001)
Completion Date: 2024-07-25
Overall Status: ‚úÖ SUCCESSFULLY COMPLETED

COMPLETION SUMMARY:
‚îú‚îÄ‚îÄ Success Criteria: 5/5 met (100%)
‚îú‚îÄ‚îÄ Deliverables: 8/8 completed and accepted
‚îú‚îÄ‚îÄ Quality Gates: All passed
‚îî‚îÄ‚îÄ Stakeholder Satisfaction: 9/10

PERFORMANCE ANALYSIS:
‚îú‚îÄ‚îÄ Timeline: 25 days (vs 20 estimated) ‚Üí +25% variance
‚îú‚îÄ‚îÄ Effort: 95 hours (vs 80 estimated) ‚Üí +18.75% variance
‚îú‚îÄ‚îÄ Quality: 92% first-time quality
‚îî‚îÄ‚îÄ Efficiency Ratio: 0.842

KEY INSIGHTS:
‚îú‚îÄ‚îÄ ‚úÖ Strengths: Clear criteria, good team coordination, early testing
‚îú‚îÄ‚îÄ ‚ö†Ô∏è  Challenges: API integration complexity, stakeholder scheduling
‚îú‚îÄ‚îÄ üìà Improvements: Better integration estimates, earlier demos
‚îî‚îÄ‚îÄ üéØ Template Updates: +30% integration testing, API risk assessment

KNOWLEDGE CAPTURED:
‚îú‚îÄ‚îÄ 8 lessons learned documented
‚îú‚îÄ‚îÄ 3 process improvements identified
‚îú‚îÄ‚îÄ 5 template updates applied
‚îú‚îÄ‚îÄ 2 risk patterns added to library
‚îî‚îÄ‚îÄ 4 best practices extracted

ARCHIVAL STATUS:
‚îú‚îÄ‚îÄ Data Migration: ‚úÖ Complete
‚îú‚îÄ‚îÄ Knowledge Capture: ‚úÖ Complete
‚îú‚îÄ‚îÄ Template Updates: ‚úÖ Applied
‚îú‚îÄ‚îÄ System Updates: ‚úÖ Complete
‚îî‚îÄ‚îÄ Archive Verification: ‚úÖ Passed

Next milestone (milestone-002) has been updated with insights from this completion.
```

**Step 9: Template Update Application**

**Live Template Enhancement:**
```yaml
# Updated milestone template based on milestone-001 insights
milestone_template_v1.1:
  estimation_adjustments:
    integration_testing: "+30% from base estimate"
    third_party_dependencies: "+20% buffer required"
    stakeholder_coordination: "+15% for scheduling delays"
    
  mandatory_checkpoints:
    - "Early stakeholder demo (25% completion)"
    - "API versioning verification (before integration)"
    - "Performance benchmarking (before deployment)"
    
  enhanced_risk_assessment:
    - api_stability_score: "1-5 scale"
    - team_coordination_complexity: "low|medium|high"
    - stakeholder_availability_risk: "verified|assumed|unknown"
```

**Step 10: Implementation Pattern**

**Complete Execution Flow:**

```markdown
When user runs `/milestone/archive [milestone-id]`, follow this EXACT pattern:

1. **Validate Prerequisites:**
   - Confirm milestone exists and is complete
   - Check all tasks have completed status

2. **Spawn All 5 Agents Using Task Tool:**
   
   I'll now spawn 5 specialized agents for comprehensive archival:
   
   [Use Task tool with Validation Agent template - replace {{MILESTONE_ID}}]
   [Use Task tool with Metrics Agent template - replace {{MILESTONE_ID}}]
   [Use Task tool with Knowledge Agent template - replace {{MILESTONE_ID}}]
   [Use Task tool with Template Agent template - replace {{MILESTONE_ID}}]
   [Use Task tool with Archive Agent template - replace {{MILESTONE_ID}}]

3. **Monitor Coordination:**
   - Validation must pass before archival
   - All analysis completes in parallel
   - Archive agent performs final migration

4. **Confirm Completion:**
   - Milestone moved to completed directory
   - Lessons learned captured
   - Templates updated for future use
```

**Step 11: Future Planning Integration**

**Forward-Looking Improvements:**
```yaml
future_planning_enhancements:
  predictive_modeling:
    - "Projects with third-party APIs need 25% additional time"
    - "Teams new to technology stack need 40% learning overhead"
    - "Complex integrations benefit from 2-week discovery phase"
    
  milestone_sequencing:
    - "Authentication milestones should complete before user features"
    - "Performance milestones need dedicated environment setup time"
    - "Documentation milestones work well in parallel with testing"
    
  resource_allocation:
    - "Senior developers needed for architecture decisions"
    - "QA involvement from 50% completion point optimal"
    - "DevOps coordination needed 1 week before deployment"
```

**Milestone Quality Checklist:**
- [ ] All success criteria validated and documented
- [ ] Performance analysis completed with variance insights
- [ ] Lessons learned captured with actionable improvements
- [ ] Templates updated based on real-world performance
- [ ] Knowledge base enhanced with new insights
- [ ] Data properly archived with complete audit trail
- [ ] Dependent milestones updated with new information
- [ ] Stakeholder satisfaction measured and recorded

**Agent Coordination for Complex Archival:**
```
"For comprehensive milestone archival, I'll coordinate multiple agents:

Primary Archive Agent: Overall archival coordination and validation
‚îú‚îÄ‚îÄ Validation Agent: Completion criteria and deliverable verification
‚îú‚îÄ‚îÄ Analysis Agent: Performance metrics and variance analysis
‚îú‚îÄ‚îÄ Knowledge Agent: Lessons learned and insight extraction
‚îú‚îÄ‚îÄ Template Agent: Estimation model and template improvements
‚îî‚îÄ‚îÄ Integration Agent: Future planning and dependency updates

Each agent will report detailed findings for comprehensive archival documentation."
```

**Anti-Patterns to Avoid:**
- ‚ùå Archiving without validating completion (creates false success metrics)
- ‚ùå Skipping performance analysis (misses improvement opportunities)
- ‚ùå Ignoring lessons learned capture (repeats same mistakes)
- ‚ùå Failing to update templates (estimation accuracy doesn't improve)
- ‚ùå Simple file move without knowledge extraction (loses valuable insights)
- ‚ùå Not updating dependent milestones (creates coordination issues)

**Final Verification:**
Before completing milestone archival:
- Have I validated ALL completion criteria against original definition?
- Are performance metrics captured with variance analysis?
- Have lessons learned been comprehensively documented?
- Are templates and estimation models updated based on outcomes?
- Is the archive complete with proper audit trail?
- Have dependent milestones been updated with new insights?

**Final Commitment:**
- **I will**: Validate every completion criterion before archival
- **I will**: Capture comprehensive performance and variance analysis
- **I will**: Extract actionable lessons learned and process improvements
- **I will**: Update templates and estimation models based on real outcomes
- **I will NOT**: Archive incomplete or unvalidated milestones
- **I will NOT**: Skip knowledge capture and continuous improvement
- **I will NOT**: Perform simple data moves without comprehensive analysis

**REMEMBER:**
This is MILESTONE ARCHIVAL mode - comprehensive completion validation, knowledge capture, and continuous improvement. The goal is to properly close completed milestones while maximizing learning for future planning effectiveness.

Executing comprehensive milestone archival protocol for validated completion and knowledge preservation...